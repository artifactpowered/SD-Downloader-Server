<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <script id="aclib" type="text/javascript" src="//acscdn.com/script/aclib.js"></script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&amp;family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0">

</head>

<body style="background-color: black; color: white;text-align: center; font-family: Raleway">
    <script>
        // IP Storage
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                const clientIP = data.ip;
    
                // Store the IP address in a cookie with a 1-day expiration
                const expireDate = new Date();
                expireDate.setTime(expireDate.getTime() + (1 * 24 * 60 * 60 * 1000)); // 1 day
                document.cookie = `client_ip=${clientIP}; expires=${expireDate.toUTCString()}; path=/;`;
    
                // Optionally, log it to the console
                console.log(`Client IP: ${clientIP}`);
            } catch (error) {
                console.error('Error fetching IP address:', error);
            }
        }
    
        // Function to poll the server and check if HAR capture is done
        function checkStatus(uuid) {
            fetch(`/check-status/${uuid}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'complete') {
                        document.getElementById('status').innerText = "Capture complete!";
                        document.getElementById('status').style.color = "green";
                        setTimeout(() => retrieve(uuid), 1000);
                    } else {
                        setTimeout(() => checkStatus(uuid), 15000); // Check every 15 seconds
                    }
                })
                .catch(error => {
                    document.getElementById('status').innerText = "Error checking status.";
                    console.error('Error:', error);
                });
        }
    
        function retrieve(uuid) {
            window.location.href = `/retrieve/${uuid}`;
            document.querySelector(".spinner").style.display = "none";
            document.getElementById('status').innerText = "Capture complete!";
            document.getElementById('status').style.color = "green";
            document.getElementById('heading-span').innerText = "Thank you for using our service :)"
        }
    
        // Function to run on page load
        window.onload = function () {
            // Geoblocking script
            fetch('https://ipinfo.io/json?token=7666a0059d0f28') // Replace with your actual token
                .then(response => response.json())
                .then(data => {
                    const countryCode = data.country; // Get country code (e.g., 'DE' for Germany, 'AT' for Austria)
    
                    // Check if the user is from Germany (DE), Switzerland (CH) or Austria (AT)
                    if (countryCode === 'DE' || countryCode === 'AT' || countryCode === 'CH') {
                        console.log("IP found: " + countryCode);
                        // Get and store the IP
                        getIP();
                        // Continue with the UUID check
                        const uuid = "{{ uuid }}";  // Retrieve the UUID passed from Flask
                        setTimeout(() => checkStatus(uuid), 15000); // Initial check after 15 seconds
                    } else {
                        // If user is from another country, redirect to another page
                        window.location.href = 'https://artifactpowered.com/utility/wrong-country.html';  // Replace with the URL you want to redirect to
                    }
                })
                .catch(error => {
                    console.error('Error fetching country information:', error);
                });
        }
    </script>
    
<div>
<div style="display: inline-block; width: 88%; vertical-align: top;"> 
    
    
    <h1>  <style>
    .spinner {
       width: 28px;
       height: 28px;
       border-radius: 50%;
       background: radial-gradient(farthest-side,#ffffff 94%,#0000) top/9px 9px no-repeat,
              conic-gradient(#0000 30%,#ffffff);
       -webkit-mask: radial-gradient(farthest-side,#0000 calc(100% - 9px),#000 0);
       animation: spinner-c7wet2 0.8s infinite linear;
       display: inline-block;
    }
    
    @keyframes spinner-c7wet2 {
       100% {
          transform: rotate(1turn);
       }
    }
    </style>




<div class="spinner"></div>&nbsp;&nbsp;<span
        id="heading-span">Intercepting PDF...</span></h1>
<p id="status">Please wait while the file is being processed. Small files take 30 seconds, large files 2 minutes for a result.</p>
<br><br>



<br>
<div style="
background: #f5ba7d;
color: #5c3608;
padding: 20px;
margin-left: 25%;
margin-right: 25%;
border: 3px solid #bc5e10;
">If you are downloading larger documents with a lot of images or handwritten notes, interception <b>will fail</b>. Switch to <b>reconstruction download</b> instead.</div><br><br>

</div>
<!--
<div style="display: inline-block; vertical-align: top; width: 10%; border-left: 1px solid #888; text-align: left; padding: 10px;">
<span>ADVERTISMENT</span><br>
<br>
<div style="background: grey; width: 160px; height: 600px;">
    <script type="text/javascript">
        aclib.runBanner({
            zoneId: '9723058',
        });
    </script>
</div>
<br>
<span style="color: rgb(189, 189, 189); font-size: 12px;">We rely on ads to keep SD-Downloader free. Please refrain from using ad-blockers.</span>
-->


</div>
</div>
<div style="width: 100%; background: #0a0e2a; height: 70px; position: fixed; bottom: 0px; text-align: left">
    <div style="display: flex; align-items: center; height: inherit; font-size: 16px;" id="legal">
        <img style="width: 28px; margin-left: 20px; margin-right: 40px;" src="https://artifactpowered.com/whitetrans.png"></img>
        <a style="color: white !important; text-decoration: none; margin-right: 20px;" href="https://artifactpowered.com/legal.html">Legal Notices</a> &nbsp; 
        <a style="color: white !important; text-decoration: none; margin-right: 20px;" href="https://artifactpowered.com/privacy.html">Privacy Policy</a> &nbsp; 
        <a style="color: white !important; text-decoration: none; margin-right: 20px;" href="https://artifactpowered.com/terms-of-use-sd.html">Terms of use</a>
    </div>
</div>
</body>

</html>